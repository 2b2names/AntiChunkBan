package me.tiger.antiChunkBan;

import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerInteractEvent;
import org.bukkit.inventory.ItemStack;
import org.bukkit.inventory.meta.BookMeta;

public class ItemExploitChecker implements Listener {

    private final AntiChunkBan plugin;

    public ItemExploitChecker(AntiChunkBan plugin) {
        this.plugin = plugin;
    }

    @EventHandler
    public void onPlayerInteract(PlayerInteractEvent event) {
        ItemStack item = event.getItem();
        if (item == null) return;

        Player player = event.getPlayer();

        // Detect oversized written books
        if (item.getItemMeta() instanceof BookMeta meta) {
            int pages = meta.getPageCount();
            int maxPages = plugin.getConfig().getInt("limits.book-pages", 100);

            if (pages > maxPages) {
                event.setCancelled(true);

                plugin.getLogger().warning(
                        "Blocked oversized book from " + player.getName()
                );

                // âœ… Use the hidden fixer instead of discordNotifier
                plugin.fixer.fixItem(player, "WRITTEN_BOOK (" + pages + " pages)");
            }
        }
    }
}
